# SEO Utils Documentation

Утилитарный модуль для управления SEO-данными в многоязычном приложении Vue.js с поддержкой динамических API-запросов вместо статичных переводов из Vue I18n.

## Обзор

Модуль `seoUtils.ts` предоставляет функции для динамического получения и обновления SEO-данных через API-запросы. Основная цель - обеспечить корректное отображение актуальных SEO-данных для поисковых систем с возможностью их централизованного управления через серверную часть приложения без необходимости пересборки фронтенда.

## Изменения в архитектуре

В отличие от предыдущей версии, которая полагалась на переводы из системы i18n, новая версия получает SEO-данные напрямую с сервера. Это позволяет контент-менеджерам обновлять мета-информацию без участия разработчиков и без перезапуска приложения.

## Импорт

```typescript
import { updateSEO, fetchSeo, updateMetaTag } from "@/utils/seoUtils";
```

## Зависимости

Модуль теперь зависит от утилиты `apiUtils` для выполнения HTTP-запросов:

```typescript
import { apiGet } from "./apiUtils";
```

## Константы

### SEO_ENDPOINT

```typescript
const SEO_ENDPOINT = "seo";
```

Базовый эндпоинт для получения SEO-данных. Полный путь формируется как `/api/v1/seo/{locale}.json`, где `{locale}` - текущий язык интерфейса.

## Типы данных

### SeoItem

```typescript
interface SeoItem {
  title: string;
  description: string;
  keywords: string;
}
```

Определяет структуру SEO-данных, получаемых с сервера. Содержит три основных поля для базовой поисковой оптимизации.

### SeoResponse

```typescript
interface SeoResponse {
  language: AvailableLocale;
  seo: SeoItem;
}
```

Описывает полный ответ API, который включает информацию о языке и собственно SEO-данные. Поле `language` используется для верификации соответствия полученных данных запрашиваемой локали.

## Функции

### updateMetaTag

```typescript
updateMetaTag(name: string, content: string): void
```

Обновляет содержимое существующего мета-тега или создает новый, если тег отсутствует в DOM. Эта функция была реализована в предыдущих версиях и остаётся неизменной - она продолжает выполнять базовые операции с DOM.

**Параметры:**

- `name` (string) - имя мета-тега (значение атрибута `name`)
- `content` (string) - содержимое мета-тега (значение атрибута `content`)

**Возвращает:** void

**Пример использования:**

```typescript
updateMetaTag("description", "Новое описание страницы");
updateMetaTag("author", "Kidoo Development Team");
```

### fetchSeo

```typescript
fetchSeo(): Promise<SeoResponse>
```

Новая асинхронная функция для получения SEO-данных с сервера. Использует текущую локаль из системы i18n для формирования правильного URL запроса.

**Параметры:** отсутствуют

**Возвращает:** Promise<SeoResponse> - промис с SEO-данными

**Пример использования:**

```typescript
try {
  const seoData = await fetchSeo();
  console.log(`Получены SEO-данные для языка: ${seoData.language}`);
} catch (error) {
  console.error("Ошибка при загрузке SEO-данных:", error);
}
```

**Формирование запроса:**

Функция автоматически формирует URL запроса на основе текущего значения `i18n.global.locale.value`. Например, для русского языка будет выполнен запрос к `/api/v1/seo/ru.json`.

### updateSEO

```typescript
updateSEO(): Promise<void>
```

Главная функция модуля, которая теперь стала асинхронной. Получает SEO-данные с сервера и обновляет соответствующие элементы страницы, используя существующую функцию `updateMetaTag`.

**Параметры:** отсутствуют

**Возвращает:** Promise<void> - промис, который разрешается после успешного обновления всех SEO-элементов

**Обновляемые элементы:**

- `document.title` - заголовок страницы из поля `data.seo.title`
- `<meta name="description">` - описание страницы из поля `data.seo.description`
- `<meta name="keywords">` - ключевые слова из поля `data.seo.keywords`
- `<html lang="">` - атрибут языка документа из текущей локали i18n

**Пример использования:**

```typescript
// При смене языка приложения
i18n.global.locale.value = "de";
try {
  await updateSEO();
  console.log("SEO-данные успешно обновлены для немецкого языка");
} catch (error) {
  console.error("Не удалось обновить SEO-данные:", error);
}
```

**Обработка ошибок:**

Функция включает try-catch блок для перехвата ошибок API. При возникновении проблем ошибка логируется в консоль, но не препятствует дальнейшей работе приложения.

## Интеграция с системой API

### Структура mock-данных

Для разработки и тестирования в директории `public/api/v1/seo/` размещаются JSON-файлы с mock-данными для каждого поддерживаемого языка.

Пример файла `ru.json`:

```json
{
  "language": "ru",
  "seo": {
    "title": "Сеть детских спортивных клубов в Германии, Австрии и Швейцарии | Kidoo Club",
    "description": "Kidoo Club — это круглогодичный спорт для детей 4–14 лет. Футбол, плавание, лыжи, скалолазание, рафтинг и десятки других активностей. Один абонемент — сотни возможностей в Германии, Австрии и Швейцарии.",
    "keywords": "детский спортивный клуб Германия Австрия Швейцария, спорт для детей, секции для детей, детский фитнес, детский футбол, детские лыжи, активный отдых для детей, клуб для детей DACH"
  }
}
```

### Переход к production API

При переходе к реальному серверному API потребуется обновить только константу `API_BASE_URL` в модуле `apiUtils`. Структура ответов должна точно соответствовать mock-файлам, чтобы избежать необходимости изменения кода фронтенда.

## Интеграция с системой локализации

### Автоматическое обновление при смене языка

```typescript
// В файле src/i18n.ts
import { updateSEO } from "@/utils/seoUtils";

export async function setLocale(locale: AvailableLocale) {
  if (!i18n.global.availableLocales.includes(locale)) {
    await loadLocaleMessages(locale);
  }
  i18n.global.locale.value = locale;
  localStorage.setItem("locale", locale);

  // Асинхронное обновление SEO при смене языка
  try {
    await updateSEO();
  } catch (error) {
    console.error("Не удалось обновить SEO-данные при смене языка:", error);
  }
}
```

### Инициализация при загрузке приложения

```typescript
// В файле src/App.vue
import { onMounted } from "vue";
import { updateSEO } from "@/utils/seoUtils";

export default {
  setup() {
    onMounted(async () => {
      // Асинхронное обновление SEO после монтирования приложения
      try {
        await updateSEO();
      } catch (error) {
        console.error("Ошибка при инициализации SEO-данных:", error);
      }
    });
  },
};
```

## Миграция с предыдущей версии

### Удалённые функции

Функция `updateSEOWithKeys` была удалена, поскольку SEO-данные теперь получаются централизованно с сервера, а не из системы переводов. Индивидуализация SEO для разных страниц теперь должна реализовываться на серверной стороне через различные эндпоинты или параметры запроса.

### Изменения в существующих функциях

Функция `updateSEO` стала асинхронной. Все вызовы этой функции необходимо обернуть в try-catch блоки и использовать await или обработчики промисов.

**Было:**

```typescript
updateSEO(); // Синхронный вызов
```

**Стало:**

```typescript
try {
  await updateSEO(); // Асинхронный вызов
} catch (error) {
  console.error("Ошибка обновления SEO:", error);
}
```

## Примеры использования

### Базовое использование с обработкой ошибок

```typescript
import { updateSEO } from "@/utils/seoUtils";

async function initializePage() {
  try {
    await updateSEO();
    console.log("SEO-данные успешно загружены и применены");
  } catch (error) {
    console.error("Не удалось инициализировать SEO:", error);
    // Можно показать пользователю уведомление или использовать fallback-данные
  }
}
```

### Получение SEO-данных без применения к странице

```typescript
import { fetchSeo } from "@/utils/seoUtils";

async function preloadSeoData() {
  try {
    const seoData = await fetchSeo();

    // Можно использовать данные для предварительной валидации
    if (!seoData.seo.title || seoData.seo.title.length < 10) {
      console.warn("Заголовок страницы может быть слишком коротким для SEO");
    }

    return seoData;
  } catch (error) {
    console.error("Не удалось предзагрузить SEO-данные:", error);
    return null;
  }
}
```

### Ручное управление отдельными мета-тегами

```typescript
import { updateMetaTag } from "@/utils/seoUtils";

// Добавление дополнительных мета-тегов, не связанных с основными SEO-данными
function setupAdditionalMetaTags() {
  updateMetaTag("author", "Kidoo Club Development Team");
  updateMetaTag("robots", "index,follow");
  updateMetaTag("theme-color", "#007bff");

  // Эти теги не перезаписываются функцией updateSEO
}
```

## Обработка ошибок и отладка

### Типы ошибок

Модуль может генерировать несколько типов ошибок:

1. **Сетевые ошибки** - проблемы с подключением к серверу
2. **HTTP ошибки** - сервер вернул статус 4xx или 5xx
3. **Ошибки парсинга** - некорректный формат JSON в ответе
4. **Ошибки валидации** - отсутствуют обязательные поля в ответе

### Отладочная информация

Для отладки можно временно добавить дополнительное логирование:

```typescript
import { fetchSeo } from "@/utils/seoUtils";

async function debugSeoFetch() {
  try {
    console.log(`Запрос SEO-данных для языка: ${i18n.global.locale.value}`);
    const data = await fetchSeo();
    console.log("Получены SEO-данные:", data);
    return data;
  } catch (error) {
    console.error("Подробности ошибки SEO:", {
      message: error.message,
      stack: error.stack,
      // Для ApiError будут доступны дополнительные поля
      status: error.status,
      statusText: error.statusText,
    });
    throw error;
  }
}
```

## Ограничения и особенности

1. **Зависимость от сетевого соединения**: В отличие от предыдущей версии, модуль теперь требует активного подключения к серверу для получения SEO-данных

2. **Асинхронность**: Все функции работы с SEO стали асинхронными, что требует соответствующих изменений в коде приложения

3. **Кеширование**: Модуль не реализует собственного кеширования. При частых сменах языка может потребоваться добавление кеш-слоя для оптимизации производительности

4. **Fallback-стратегия**: При недоступности API отсутствует автоматический fallback к статичным данным, что требует ручной реализации резервных механизмов

5. **Валидация данных**: Модуль не выполняет глубокую валидацию полученных с сервера данных, полагаясь на корректность API-ответов

## Совместимость

- **I18n**: 9.0+ (используется только для получения текущей локали)
- **TypeScript**: 4.0+
- **Браузеры**: Все современные браузеры с поддержкой fetch API и ES6+

## Связанные файлы

- `src/utils/apiUtils.ts` - утилиты для выполнения API-запросов
- `src/i18n.ts` - конфигурация интернационализации (для получения текущей локали)
- `public/api/v1/seo/*.json` - mock-файлы с SEO-данными для разработки
